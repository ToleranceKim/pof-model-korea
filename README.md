# Global Probability-of-Fire (PoF) Replication for Korea

이 프로젝트는 ECMWF에서 개발한 글로벌 산불 예측 모델(PoF)을 한국 지역에 맞게 구현하는 것을 목표로 합니다.
기상 데이터, 연료 조건, 지형 정보 등 19개 변수를 활용하여 0.1° 격자 단위로 산불 발생 확률을 예측합니다.

> 참고 논문: _Global data-driven prediction of fire activity_ (ECMWF, 2024)

> https://www.nature.com/articles/s41467-025-58097-7

---

## 1. PoF 활용 데이터

### 데이터 출처 및 특성

| 구분          | 상세 변수·지표                                | 설명                                 | 시간 해상도         | 공간 해상도\* | 1차 출처·링크                                                | 무료 계정 / API | 수집·갱신 주기          | 이용 가능 기간          | 수집 방법 요약                          | 한국 적용 | 근거                                       |
| ------------- | --------------------------------------------- | ------------------------------------ | ------------------- | ------------- | ------------------------------------------------------------ | --------------- | ----------------------- | ----------------------- | --------------------------------------- | :-------: | ------------------------------------------ |
| Weather       | 2 m T, 2 m Td, 10 m Wind, Total Precip        | 지표 기온, 이슬점, 풍속, 강수량      | 일별 (1 h→일)       | 0.1° (~9 km)  | ERA5-Land [CDS](https://doi.org/10.24381/cds.e2161bac)       | 필요            | 매일 (T-3 h 지연)       | 1950-01-01 → 현재       | `cdsapi` 요청 시 `area=[38,124,33,132]` |     o     | ERA5-Land는 전 지구 등격자 → 우리나라 포함 |
| Ignition-dyn  | Lightning flash density                       | 낙뢰 발생 밀도 (자연 발화 주요 원인) | 일별                | 0.1°          | ERA5 단층 변수                                               | 필요            | 매일                    | 2000-01-01 → 현재       | `cdsapi` 에서 변수만 변경               |     o     | ERA5 전 지구 자료, 동일 영역 지정 가능     |
| Fuel-model    | Fuel Load 4종, Fuel Moist 3종                 | 연료량 및 수분 함량 (인화성 결정)    | 일별                | 0.1°          | Global Fuel v1.2 [Zenodo](https://doi.org/10.24381/378d1497) | 불필요          | 1 일 NRT                | 2014-01-01 → 2023-12-31 | ZIP → NetCDF                            |     o     | "daily global 9 km" 명시                   |
| Fuel-sat      | L-VOD                                         | L-band 식생 광학두께 (식물 수분량)   | 월별                | 25 km→0.1°    | SMOS-IC (INRAE)                                              | 불필요          | 월 NRT                  | 2010-01-01 → 2021-07-31 | `wget`+`cdo remap`                      |     o     | SMOS 문서: daily global retrievals         |
|               | LAI-low, LAI-high                             | 잎면적지수 (저층/고층 식생)          | 10-일               | 300 m→0.1°    | Copernicus LAI v2                                            | 필요            | 10-일 NRT               | 1999-04-01 → 현재       | CDS API → 리샘플                        |     o     | CGLS LAI: global 300 m 제공                |
| Ignition-stat | Vegetation Type, Urban Frac, Orography        | 식생유형, 도시비율, 지형고도         | 고정                | 0.1°          | ECMWF ECLand Static                                          | 필요            | –                       | 2023 스냅숏             | CDS "ancillary" 다운로드                |     o     | 전 지구 정적 마스크                        |
|               | Population Density                            | 인구 밀도 (인위 발화 위험 지표)      | 5 년                | 2.5′→0.1°     | SEDAC GPW v4                                                 | 필요            | 5 년                    | 2000·05·10·15·20        | GeoTIFF → `gdalwarp`                    |     o     | GPW: Gridded Population of the World       |
|               | Road Density                                  | 도로 밀도 (접근성 및 인위 발화 관련) | 고정                | 5′→0.1°       | CIESIN GRiD-2018                                             | 불필요          | –                       | 2018 스냅숏             | GeoTIFF 직접 다운로드                   |     o     | GRiD: global road density 래스터           |
| Target        | MODIS Active Fire (MCD14 v6.1, low-conf 제외) | 실제 산불 발생 지점 (학습 타깃)      | 궤도 4×/일 → 일집계 | 1 km→0.1°     | NASA FIRMS [SFTP](https://firms.modaps.eosdis.nasa.gov/)     | 필요            | 10 분 NRT / 월 아카이브 | 2000-02-24 → 현재       | REST bbox(`124,33,132,38`) 또는 SFTP    |     o     | FIRMS API: bbox 기반 글로벌 다운로드 지원  |

\* 모든 입력은 학습 전에 0.1°(~9 km) 격자로 리그리딩합니다.  
ERA5 확정값은 약 3 개월 지연 후 공개됩니다.

### 변수별 상세 설명

#### 1. 기본 식별 변수

| 열 이름   | 쉬운 이름 | 설명                             | 단위·형식  | 중요 이유                               |
| --------- | --------- | -------------------------------- | ---------- | --------------------------------------- |
| `date`    | 날짜      | 관측·예보 기준일 (UTC 00시 기준) | YYYY-MM-DD | 모든 변수가 하루 단위로 집계되는 기준점 |
| `grid_id` | 격자 ID   | 0.1° 격자 인덱스, 위치 변환 포함 | 정수       | 공간 결합(JOIN)·모델 학습용 1차 키      |
| `lead`\*  | 예보 앞날 | 발표일로부터 0·1·2·3... 일 뒤    | 0-5일      | 실시간 예측: 오늘~5일 후 구분           |

- `lead`는 훈련용 과거 관측만 사용할 경우 생략 가능, 실시간 예보에서는 필수

#### 격자 인덱스 변환 방식

`grid_id`는 위도(-90°~+90°)와 경도(-180°~+180°)를 0.1° 간격으로 나눈 고유 위치 값입니다.

**계산 방법**:

1. 위도를 0.1° 단위로 변환: `lat_bin = int(np.floor(lat / 0.1))`
2. 경도를 0.1° 단위로 변환: `lon_bin = int(np.floor(lon / 0.1))`
3. 최종 격자ID: `grid_id = (lat_bin + 900) * 3600 + (lon_bin + 1800)`

**예시**: 서울 좌표 (37.5°N, 127.0°E)

- `lat_bin = 375`, `lon_bin = 1270`
- `grid_id = (375 + 900) * 3600 + (1270 + 1800) = 4,593,070`

**역변환**:

- `lat_bin = (grid_id // 3600) - 900`
- `lon_bin = (grid_id % 3600) - 1800`
- 위경도 = `(lat_bin * 0.1 + 0.05, lon_bin * 0.1 + 0.05)` (격자 중심점)

#### 2. 동적 예보 변수 (매일 갱신)

| 열 이름              | 쉬운 이름     | 설명                                 | 단위           | 중요 이유                         |
| -------------------- | ------------- | ------------------------------------ | -------------- | --------------------------------- |
| `t2m`                | 2 m 기온      | 지표 2 m 고도 공기 온도              | K (℃=K-273.15) | 고온은 연료 건조·발화 확률 증가   |
| `td2m`               | 2 m 이슬점    | 포화되는 온도 (상대습도와 동일 정보) | K              | 낮은 이슬점→공기 건조→쉽게 타오름 |
| `wind10m`            | 10 m 풍속     | √(u10²+v10²)로 계산한 10 m 풍속      | m/s            | 바람은 화재 확산·산소 공급        |
| `precip`             | 총 강수량     | 24시간 누적 강우·적설량              | mm/day         | 비가 적을수록 발화·확산 위험 증가 |
| `lightning`          | 낙뢰 밀도     | 단위 면적당 번개 발생 횟수           | 회/km²/day     | 자연 발화의 주요 원인             |
| `live_fuel_moist`    | 생연료 수분   | 살아있는 잎·줄기의 수분 비율         | %              | 젖은 식생은 잘 타지 않음          |
| `dead_foliage_moist` | 낙엽 수분     | 죽은 잎의 수분 함량                  | %              | 건조할수록 발화 쉬움              |
| `dead_wood_moist`    | 고사목 수분   | 죽은 나무·가지의 수분 함량           | %              | 건조할수록 발화 쉬움              |
| `live_leaf_load`     | 생잎 연료량   | 단위면적 당 살아있는 잎 건조중량     | kg/m²          | 가연물 총량                       |
| `live_wood_load`     | 생목 연료량   | 단위면적 당 살아있는 목재 건조중량   | kg/m²          | 가연물 총량                       |
| `dead_leaf_load`     | 낙엽 연료량   | 단위면적 당 죽은 잎 건조중량         | kg/m²          | 가연물 총량                       |
| `dead_wood_load`     | 고사목 연료량 | 단위면적 당 죽은 목재 건조중량       | kg/m²          | 가연물 총량                       |

#### 3. 준정적 변수 (월/데카드 주기 갱신)

| 열 이름    | 쉬운 이름 | 설명                                | 단위   | 중요 이유             |
| ---------- | --------- | ----------------------------------- | ------ | --------------------- |
| `vod_L`    | VOD-L     | L-밴드 식생광학밀도, 월평균 후 복사 | 무차원 | 식생 건조도 간접 지표 |
| `lai_low`  | LAI-저    | 저층 식생(초지·관목) 잎 면적 지수   | m²/m²  | 연료량·광합성 관련    |
| `lai_high` | LAI-고    | 고층 식생(숲 상층) 잎 면적 지수     | m²/m²  | 연료량·광합성 관련    |

#### 4. 정적 변수 (변경 없음)

| 열 이름      | 쉬운 이름 | 설명                            | 단위    | 중요 이유                 |
| ------------ | --------- | ------------------------------- | ------- | ------------------------- |
| `veg_type`   | 식생형    | IGBP 분류에 따른 식생 유형 코드 | 분류 ID | 연료 특성 결정            |
| `orography`  | 표고      | 지표면 평균 고도                | m       | 고산→건조/바람 증가       |
| `urban_frac` | 도시 비율 | 격자 내 도시화 비율             | %       | 인위 점화 증가, 연료 감소 |
| `pop_dens`   | 인구밀도  | 단위 면적 당 인구수             | 명/km²  | 인위 점화 위험 관련       |
| `road_dens`  | 도로밀도  | 단위 면적 당 도로 길이          | km/km²  | 인위 점화 및 접근성 관련  |

#### 5. 타깃 변수

| 열 이름   | 쉬운 이름      | 설명                                         | 단위     | 중요 이유         |
| --------- | -------------- | -------------------------------------------- | -------- | ----------------- |
| `af_flag` | 화점 발생 여부 | MODIS 산불 감지 결과를 0.1° 격자/일별로 집계 | 0 또는 1 | 모델 학습 목표 값 |

---

## 2. 실시간 예측 파이프라인 입력 변수

아래 표는 **실시간 예측 파이프라인에서 19개 드라이버를 어떻게 만들어 넣는지**를 한글 설명 + 근거 요약까지 포함하여 정리한 것입니다.
(O = 대한민국 전역 무료 API 또는 FTP로 확보 가능)

| 그룹                                      | 변수 (개수)                              | 실시간 원천·해상도                        | 전처리 → 모델 입력<br>(0.1°, 일별)                                       | 갱신 / 예보 리드                  | 5일까지만 쓰는 이유 (요약)                            | 논문·문헌 위치                       |
| ----------------------------------------- | ---------------------------------------- | ----------------------------------------- | ------------------------------------------------------------------------ | --------------------------------- | ----------------------------------------------------- | ------------------------------------ |
| ① 동적 예보<br>(매일 00 UTC 새 예보 필요) | Weather 4<br>t2m, td2m, 10 m wind, tp    | ECMWF HRES GRIB<br>0.1°, 3 h step 0–240 h | • 3 h→하루 평균/합계<br>• wind10m = √(u10²+v10²)<br>• 격자버림 → grid_id | 매일<br>step 0–120 h → lead 0–5 d | 6일 뒤부터 HRES T/RH/WIND RMSE 급증 → ROC-AUC 급락    | Fig 2 & 3, Methods "Weather drivers" |
|                                           | Lightning 1                              | HRES CAPE×PREC proxy 3 h                  | 3 h 합계 → 하루 값                                                       | 매일, lead 0–5 d                  | 번개 예보 ETS ≤0.2 @ +144 h (ECMWF TechMemo 879)      | Supp. §2                             |
|                                           | Fuel Moist+Load 7<br>LFM/DFM/DWM +4 load | CEMS-FWI GRIB 24 h step 0–10 d            | 이미 일별 → 그대로 사용                                                  | 매일, lead 0–5 d                  | FWI ensemble spread @ +6 d ↑ 50% → moisture 오차 확대 | Methods "Fuel model forecast"        |
| ② 준정적<br>(월 / 데카드 주기)            | VOD-L 1                                  | SMOS-IC NetCDF<br>1 d, 25 km (결측 多)    | • 한 달 완결 후 월평균<br>• 9 km 리샘플 → 그 달 모든 날에 복사           | 월 1회<br>(지난달 자료)           | 위성 궤도공백 보완, 월평균이 가장 안정적              | Supp. Table S2                       |
|                                           | LAI 2 (low/high)                         | Copernicus LAI<br>10-day comp, 300 m      | • ①–③ 데카드 → 월평균<br>• 300 m→0.1° 평균                               | 10일마다 (데카드) → 월평균 사용   | 논문 "monthly LAI composites, resampled daily" 명시   | Methods                              |
| ③ 정적                                    | Veg-type, UrbanFrac, Orography 3         | EC-Land Static 0.1°                       | 최초 적재 후 매회 조인만                                                 | —                                 | —                                                     | —                                    |
|                                           | PopDensity, RoadDensity 2                | GPW v4 2.5′ / GRiD-2018 5′                | GDAL warp → 0.1°, 최근 자료 고정                                         | —                                 | —                                                     | Supp. Table S3                       |
| Target                                    | MODIS AF flag 1                          | FIRMS NRT (1 km, 4×/d) (O)                | conf < 30 필터 → 0.1° 일집계 → af_flag                                   | 1–3 h 지연                        | —                                                     | Methods "positive hit…"              |

### 표 보는 방법

- **리드타임(lead)**: 예보 발표 시점으로부터 n일 뒤의 입력값을 의미
  - HRES step 48 h → lead 2 d 같은 식
- **동적 14개**는 하나의 HRES / FWI 예보에서 lead 0–5 d를 동시에 뽑아 사용
- **준정적 3개**는 월·데카드 평균 후 해당 기간 모든 날에 복사(persistence)
- **정적 5개**는 한 번 저장 → 매 러닝 배치에서 그냥 조인

### "왜 5일까지만?" — 근거 요약

- **예보 정확도**: HRES, CEMS-FWI 모두 +6 d 이후 T/RH/WIND/FMC RMSE 급등 → 발화 확률 분포가 노이즈화
- **Ignition 변수(번개)**: CAPE 기반 proxy 예보 성능이 +5 d 넘어서면 ETS·FAR 급감
- **논문 스킬 곡선(Fig 3)**: AUC·Pierce Skill +5 d 이후 급락→경보품질 미달
- **실무 활용성**: 산림·소방 선제 배치 KPI가 3–5 d, 그 이상은 기상청 중기예보 체계와 기능 중복

따라서 서비스 경보 범위는 lead 0 – 5 d(오늘~5일 후)가 '국제 표준·논문 설계·운영 신뢰도' 3박자를 모두 충족합니다.

---

## 3. 데이터셋 스키마

아래 표는 모델 학습과 예측에 사용되는 변수들을 상세히 설명합니다. 실시간 파이프라인의 그룹화(동적/준정적/정적)에 맞춰 정리했습니다.

### 기본 식별 변수

| 열 이름   | dtype            | 설명                                                                                                                                                                                                                                                                                                                               | 단위 | 출처   |
| --------- | ---------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---- | ------ |
| `date`    | `datetime64[ns]` | 샘플 날짜 (YYYY-MM-DD, UTC)                                                                                                                                                                                                                                                                                                        | -    | -      |
| `grid_id` | `int32`          | 0.1° 격자 인덱스, 계산식: `(lat_bin + 900) * 3600 + (lon_bin + 1800)`<br>위치 변환 과정: lat_bin = int(np.floor(lat / 0.1)), lon_bin = int(np.floor(lon / 0.1))<br>예) 위도 37.5°N, 경도 127.0°E → lat_bin=375, lon_bin=1270 → grid_id = 4,593,070<br>역변환: lat_bin = (grid_id // 3600) - 900, lon_bin = (grid_id % 3600) - 1800 | -    | 계산값 |

### 격자 인덱싱 시스템 설명

**격자 ID 체계의 학술적 배경**:

- **등격자(Equal Angle Grid)**: 본 프로젝트에서 사용하는 0.1° 등간격 격자는 기상학 및 지구과학에서 널리 사용되는 표준 방식입니다. 등간격 격자는 좌표 변환이 단순하고 직관적이라는 장점이 있습니다.
- **격자 인덱싱 방식**: 이 체계는 위경도 좌표를 정수 인덱스로 변환하는 전통적인 방법을 따릅니다:

  1. 위도(-90° ~ +90°)를 0.1° 단위로 분할 → 총 1,800개 행
  2. 경도(-180° ~ +180°)를 0.1° 단위로 분할 → 총 3,600개 열
  3. 각 위치에 고유 정수 ID 부여 → 총 6,480,000개 격자

- **계산 효율성**:

  - 단일 정수형 ID를 통해 위/경도 두 개의 좌표를 효율적으로 관리
  - 데이터베이스 인덱싱, 해싱, 조인 연산이 최적화됨
  - 32비트 정수(int32)로 충분히 표현 가능(최대 값 6,479,999)

- **학술 연구와의 연계**:
  - ERA5-Land, ECMWF HRES와 같은 기상/기후 모델에서 사용하는 격자 구조와 호환
  - 전지구 위치 기반 연구에서 널리 사용되는 인덱싱 방식
  - FIRMS 산불 데이터와 같은 위성 관측 데이터를 격자화하는 표준 방법

이 격자 인덱싱 시스템은 계산 효율성, 저장 공간 최적화, 다양한 공간 해상도 데이터 간 처리 용이성 등의 이점을 제공합니다.

### ① 동적 예보 변수 (매일 갱신, 리드타임 0-5일)

| 열 이름              | dtype     | 설명                | 단위       | 범위    | 원천                   | 전처리 방법                  |
| -------------------- | --------- | ------------------- | ---------- | ------- | ---------------------- | ---------------------------- |
| `t2m`                | `float32` | 지상 2m 기온        | K (켈빈)   | 240-320 | ERA5-Land / HRES       | 3시간 → 일평균               |
| `td2m`               | `float32` | 지상 2m 이슬점 온도 | K (켈빈)   | 230-310 | ERA5-Land / HRES       | 3시간 → 일평균               |
| `wind10m`            | `float32` | 지상 10m 풍속       | m/s        | 0-25    | ERA5-Land / HRES       | √(u10²+v10²), 3시간 → 일평균 |
| `precip`             | `float32` | 강수량              | mm/day     | 0-200   | ERA5-Land / HRES       | 3시간 → 일누적               |
| `lightning`          | `float32` | 낙뢰 플래시 밀도    | 회/km²/day | 0-50    | ERA5 / HRES CAPE proxy | 3시간 → 일누적               |
| `live_fuel_moist`    | `float32` | 활엽 연료 수분      | %          | 30-200  | CEMS-FWI               | 그대로 사용                  |
| `dead_foliage_moist` | `float32` | 고사 낙엽 수분      | %          | 5-50    | CEMS-FWI               | 그대로 사용                  |
| `dead_wood_moist`    | `float32` | 고사 목재 수분      | %          | 5-30    | CEMS-FWI               | 그대로 사용                  |
| `live_leaf_load`     | `float32` | 활엽 잎 하중        | kg/m²      | 0-2     | Global Fuel v1.2       | 그대로 사용                  |
| `live_wood_load`     | `float32` | 활엽 목재 하중      | kg/m²      | 0-5     | Global Fuel v1.2       | 그대로 사용                  |
| `dead_leaf_load`     | `float32` | 고사 낙엽 하중      | kg/m²      | 0-3     | Global Fuel v1.2       | 그대로 사용                  |
| `dead_wood_load`     | `float32` | 고사 목재 하중      | kg/m²      | 0-5     | Global Fuel v1.2       | 그대로 사용                  |

### ② 준정적 변수 (월/데카드 주기 갱신)

| 열 이름    | dtype     | 설명                            | 단위   | 범위  | 원천           | 전처리 방법                 |
| ---------- | --------- | ------------------------------- | ------ | ----- | -------------- | --------------------------- |
| `vod_L`    | `float32` | L-밴드 식생광학밀도             | 무차원 | 0-1.5 | SMOS-IC        | 25km → 0.1°, 월평균 후 복사 |
| `lai_low`  | `float32` | 저층 식생 LAI (Leaf Area Index) | m²/m²  | 0-3   | Copernicus LAI | 300m → 0.1°, 월평균 후 복사 |
| `lai_high` | `float32` | 고층 식생 LAI (Leaf Area Index) | m²/m²  | 0-7   | Copernicus LAI | 300m → 0.1°, 월평균 후 복사 |

### ③ 정적 변수 (변경 없음)

| 열 이름      | dtype     | 설명                   | 단위    | 범위      | 원천             | 전처리 방법          |
| ------------ | --------- | ---------------------- | ------- | --------- | ---------------- | -------------------- |
| `veg_type`   | `int8`    | 식생 유형 (ECMWF 분류) | 분류 ID | 0-20      | ECMWF ECLand     | 그대로 사용          |
| `orography`  | `int16`   | 고도                   | m       | -500-5000 | ECMWF ECLand     | 그대로 사용          |
| `urban_frac` | `float32` | 도시 면적 비율         | %       | 0-100     | ECMWF ECLand     | 그대로 사용          |
| `pop_dens`   | `float32` | 인구 밀도              | 명/km²  | 0-5000    | SEDAC GPW v4     | 2.5' → 0.1° 리샘플링 |
| `road_dens`  | `float32` | 도로 밀도              | km/km²  | 0-10      | CIESIN GRiD-2018 | 5' → 0.1° 리샘플링   |

### 타깃 변수

| 열 이름   | dtype   | 설명                                           | 단위 | 범위 | 원천       | 전처리 방법                  |
| --------- | ------- | ---------------------------------------------- | ---- | ---- | ---------- | ---------------------------- |
| `af_flag` | `uint8` | MODIS 산불 감지 (1 = 산불 발생, 0 = 산불 없음) | -    | 0-1  | NASA FIRMS | low-conf 필터링, 0.1° 일집계 |

### 추가 정보

- **데이터셋 크기**: 한반도 범위는 약 480개 격자셀, 전체 데이터는 약 17만 행(정확한 크기는 기간에 따라 다름)
- **한 행 = "하루 × 격자셀"**: 예) 2019-05-12, grid #123456, 19 features, `af_flag=0/1`
- **클래스 불균형**: 양성(산불 발생) ≈ 0.3955% (74,844건 중 296건)
- **저장 형식 권장사항**:
  - 대용량 학습용으로 Parquet 파티션(`year=`) 사용
  - 음성 클래스 1/20 다운샘플링으로 용량 절감

### 그룹별 변수 활용 패턴

- **동적 14개 변수**: 매일 0-5일 예보를 동시에 사용
- **준정적 3개 변수**: 월/데카드 평균값을 해당 기간 전체에 적용
- **정적 5개 변수**: 한 번 저장 후 재사용

---

## 4. 단계별 모델 변수 확장

| 단계 | 사용 변수         | 추천 학습 기간 | 성능 향상\* | 논문 근거             |
| ---- | ----------------- | -------------- | ----------- | --------------------- |
| S1   | Weather 4종       | 2003-현재      | 기준        | Fig 2 – Weather only  |
| S2   | + Lightning       | 2003-현재      | +3 pp       | Fig 2 개선            |
| S3   | + Fuel Moist 3종  | 2014-현재      | +15 pp      | Fuel only 손실 –15 pp |
| S4   | + Fuel Load 4종   | 2014-현재      | +5 pp       | Ablation 결과         |
| S5   | + Static Veg·Topo | 2014-현재      | +2 pp       | Fig 2 두 요소 조합    |
| S6   | + Population·Road | 2014-현재      | +3 pp       | 사람 발화 보정        |
| S7   | + VOD·LAI 3종     | 2014-2021      | +2 pp       | Full 대비 −3 ~ 7 pp   |
| S8   | Full 19종         | 2014-2021      | 최고        | 논문 최종 모델        |

\* pp = percentage-point, 논문 Fig 2·Extended Data 4 참조.

---

## 5. 데이터·모델 범위 확장 전략

1. Weather-only 단계는 1950-현재 전체 기간 활용 가능
2. Fuel 포함 이후는 최소 2014-현재
3. VOD·LAI는 2021-07 이후 결측 → 최근값 유지 or 대체 지표 사용
4. 한국 특화 파인튠: KMA LDAPS/KIM 예보 + 국립산림과학원 연료지도 + SGIS 인구격자 적용

---

## 6. 데이터셋 변경 사항 (2024년 5월)

### ERA5-Land에서 ERA5로 변경

**배경 및 문제점:**

- 기존 ERA5-Land 데이터셋은 육지 영역만 제공하기 때문에, 한반도 서쪽 지역(124°-129°E)의 데이터가 대부분 누락됨
- 분석 결과 산불 데이터의 82.53%가 날씨 데이터 커버리지 영역 밖에 위치하는 문제 발견
- 육지 영역만 포함하는 ERA5-Land의 특성으로 인해 한반도 서부 지역 대부분이 날씨 데이터 범위에서 제외됨

**변경 내용:**

- 기상 데이터를 ERA5-Land에서 ERA5로 변경
- 새로운 데이터셋 출처: ERA5 (reanalysis-era5-single-levels)
- ERA5는 육지와 해양 모두에 대한 데이터를 제공하므로 의도한 전체 영역(124°-132°E)에 대한 데이터를 모두 포함

**개선 효과:**

- 한반도 서부 지역(124°-129°E)을 포함한 전체 연구 영역에 대한 기상 데이터 확보
- 산불 데이터 포인트와 날씨 데이터의 공간적 일치도 대폭 향상
- 예측 모델의 정확도 및 지역적 편향 감소 예상

**데이터 수집 방법 변경:**

```python
# 기존 ERA5-Land 데이터 수집 (육지만 포함)
c.retrieve("reanalysis-era5-land", {...})

# 변경된 ERA5 데이터 수집 (육지 + 해양)
c.retrieve("reanalysis-era5-single-levels", {...})
```

**참고:**

- ERA5-Land는 육지 영역에 최적화된 데이터셋이지만, 한국과 같이 해안선이 복잡한 지역에서는 육지/해양 경계에서 데이터 손실 발생
- ERA5는 전체 지구 표면(육지+해양)에 대한 데이터를 제공하여 연구 영역 전체를 커버할 수 있음
- 데이터 해상도와 격자 구조는 두 데이터셋 모두 0.1° 격자 시스템 사용

---

## 7. 평가 지표 (논문 동일)

- Brier score, LogLoss, ROC-AUC, Pearson r, Calibration Error
- 얼리 스톱 10 round, 불균형 보정 `scale_pos_weight`

---

### 참고 링크

- 논문 Table 1 (19 drivers), Fig 2 (Ablation), Fig 3 (Skill), Methods § Training dataset
- Code capsule : `doi:10.24433/CO.8570224.v1` — 데이터 전처리 & XGBoost 파이프라인

---

## 8. 환경 설정 및 실행 방법

### 8.1 필요 환경

- Python 3.8 이상
- pip 또는 conda 패키지 관리자

### 8.2 의존성 설치

이 프로젝트는 가상 환경을 사용하여 의존성을 관리하는 것을 권장합니다.

#### venv 사용

```bash
# 가상환경 생성
python -m venv venv

# 가상환경 활성화 (Windows)
venv\Scripts\activate

# 가상환경 활성화 (Mac/Linux)
source venv/bin/activate

# 의존성 설치
pip install -r requirements.txt
```

### 8.3 API 키 설정

데이터 수집을 위해 Copernicus Climate Data Store API 접근이 필요합니다:

1. [Copernicus Climate Data Store](https://cds.climate.copernicus.eu/)에 계정 생성
2. 프로젝트 루트에 `.env` 파일 생성하고 다음 내용 입력:

```
# Copernicus Climate Data Store API 설정
CDS_API_URL=https://cds.climate.copernicus.eu/api
CDS_API_KEY=your-api-key-here
```

### 8.4 파이프라인 실행

```bash
# 전체 파이프라인 실행 (수집 + 전처리)
python run.py

# 모델링 실행
python run_modeling.py
```

자세한 파이프라인 실행 방법은 아래 8.2 섹션을 참조하세요.

---

## 9. 데이터 수집 및 전처리 이슈 해결

### 9.1 발견된 문제점

- **지리적 범위 불일치**: 타겟 데이터(af_flag_korea.csv)와 날씨 데이터의 grid_id 범위가 일치하지 않았습니다.

  - 타겟 데이터 범위: 4,488,667 - 4,632,683
  - 날씨 데이터 범위: 4,431,090 - 4,611,086
  - 산불 발생(af_flag=1) 데이터가 주로 날씨 데이터에서 누락된 영역에 집중되어 있었습니다.

- **조인 방식 문제**: 날씨 데이터 기준의 left join으로 인해 많은 af_flag=1 데이터가 누락되었습니다.
  - 타겟 데이터에는 296개의 산불 발생 데이터가 존재
  - 조인 후 최종 데이터에는 산불 발생 데이터가 0개 (전부 누락)

### 9.2 해결 방안

1. **수집 과정 수정**:

   - BBOX 범위를 확장: `[38, 124, 33, 132]` → `[39, 124, 33, 132]` (북위 39도까지)
   - 이를 통해 af_flag 데이터의 전체 범위(최대 38.6도)를 포함하도록 개선

2. **전처리 과정 수정**:
   - 병합 방식 변경: `how='left'` → `how='right'`로 변경하여 모든 타겟 데이터 보존
   - 결측치 처리: 날씨 데이터가 없는 지점의 기상 변수를 적절히 대체
     - 온도, 습도, 바람 변수: 해당 변수의 평균값으로 대체
     - 강수량: 0으로 대체

### 9.3 검증 필요 사항

- **데이터 완전성**: 최종 데이터셋에 af_flag=1인 데이터가 원본의 296개 모두 포함되었는지 확인
- **격자 간 공간적 연속성**: 실제 측정된 값과 결측치 대체값 사이에 급격한 차이가 없는지 확인
- **모델 성능 영향**: 결측치 대체로 인한 모델 예측 성능 영향 평가 필요

이러한 개선을 통해 산불 위험 예측 모델링에 필요한 완전한 데이터셋을 구축할 수 있게 되었습니다.
